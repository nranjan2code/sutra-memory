[package]
name = "sutra-storage"
version = "0.1.0"
edition = "2021"
authors = ["Sutra AI Team"]

[lib]
name = "sutra_storage"
crate-type = ["rlib"]  # Rust library only

[dependencies]
# Core concurrency and collections
dashmap = "5.5"                    # Lock-free concurrent HashMap
crossbeam = "0.8"                  # Lock-free data structures
parking_lot = "0.12"               # Faster mutexes
smallvec = "1.11"                  # Stack-allocated vectors
arc-swap = "1.6"                   # Lock-free atomic pointer swaps
im = "15.1"                        # Immutable collections with structural sharing

# Memory mapping and I/O
memmap2 = "0.9"                    # Memory-mapped files
bytemuck = { version = "1.14", features = ["derive"] }  # Zero-copy casting

# Serialization
bincode = "1.3"                    # Binary serialization (Grid)
rmp-serde = "1.1"                  # MessagePack serialization (Python clients)
serde = { version = "1.0", features = ["derive"] }  # Serialization framework
serde_json = "1.0"                 # JSON serialization

# SIMD and math
simd-json = "0.13"                 # Fast JSON with SIMD

# Vector search (HNSW)
usearch = "2.21"                   # USearch: production HNSW with true mmap persistence

# Utilities
thiserror = "1.0"                  # Error handling
anyhow = "1.0"                     # Error context
log = "0.4"                        # Logging
env_logger = "0.11"                # Logging implementation
rayon = "1.8"                      # Data parallelism
hex = "0.4"                        # Hex encoding for IDs
md5 = "0.7"                        # MD5 hashing for ConceptId fallback
tokio = { version = "1.40", features = ["rt-multi-thread", "macros", "signal", "net", "io-util"] }  # Async runtime
tracing = "0.1"                    # Structured logging
tracing-subscriber = "0.3"         # Logging implementation

# Learning pipeline dependencies
async-trait = "0.1"                # Async traits for embedding provider
reqwest = { version = '0.11', features = ['json'] }  # HTTP client for embedding service
regex = "1.10"                     # Pattern matching for association extraction
once_cell = "1.19"                 # Lazy static initialization

# Security and Authentication
sha2 = "0.10"                      # SHA-256 hashing
hmac = "0.12"                      # HMAC authentication
base64 = "0.21"                    # Base64 encoding for tokens
tokio-rustls = "0.26"              # TLS for TCP connections
rustls = "0.21"                    # Rust TLS implementation
rustls-pemfile = "1.0"             # PEM certificate parsing

[dev-dependencies]
criterion = "0.5"                  # Benchmarking
proptest = "1.4"                   # Property-based testing
tempfile = "3.8"                   # Temporary directories for testing

# TCP Server binary
[[bin]]
name = "storage-server"
path = "src/bin/storage_server.rs"

# Profiles are configured at the workspace root

# TODO: Add benchmarks later
# [[bench]]
# name = "storage_bench"
# harness = false
