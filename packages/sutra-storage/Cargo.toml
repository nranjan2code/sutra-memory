[package]
name = "sutra-storage"
version = "0.1.0"
edition = "2021"
authors = ["Sutra AI Team"]

[lib]
name = "sutra_storage"
crate-type = ["rlib"]  # Rust library only (Python bindings disabled for testing)

[dependencies]
# Core concurrency and collections
dashmap = "5.5"                    # Lock-free concurrent HashMap
crossbeam = "0.8"                  # Lock-free data structures
parking_lot = "0.12"               # Faster mutexes
smallvec = "1.11"                  # Stack-allocated vectors
arc-swap = "1.6"                   # Lock-free atomic pointer swaps
im = "15.1"                        # Immutable collections with structural sharing

# Memory mapping and I/O
memmap2 = "0.9"                    # Memory-mapped files
bytemuck = { version = "1.14", features = ["derive"] }  # Zero-copy casting

# Serialization
bincode = "1.3"                    # Binary serialization
serde = { version = "1.0", features = ["derive"] }  # Serialization framework
serde_json = "1.0"                 # JSON serialization

# SIMD and math
simd-json = "0.13"                 # Fast JSON with SIMD

# Vector search (HNSW) - incremental updates, persistence
hnsw_rs = "0.3"                    # HNSW with incremental insert support

# Python bindings (disabled for testing)
# pyo3 = { version = "0.20", features = ["extension-module", "abi3-py38"] }
# numpy = "0.20"                     # NumPy integration

# Utilities
thiserror = "1.0"                  # Error handling
anyhow = "1.0"                     # Error context
log = "0.4"                        # Logging
env_logger = "0.11"                # Logging implementation
rayon = "1.8"                      # Data parallelism
hex = "0.4"                        # Hex encoding for IDs
md5 = "0.7"                        # MD5 hashing for ConceptId fallback
tokio = { version = "1.40", features = ["rt-multi-thread", "macros", "signal"] }  # Async runtime
tonic = { version = "0.10", features = ["transport"] }  # gRPC framework
prost = "0.12"                     # Protocol buffers runtime
tower = "0.4"                      # Middleware

[dev-dependencies]
criterion = "0.5"                  # Benchmarking
proptest = "1.4"                   # Property-based testing
tempfile = "3.8"                   # Temporary directories for testing

[build-dependencies]
tonic-build = "0.10"               # Protobuf code generation

[profile.release]
opt-level = 3
lto = true                         # Link-time optimization
codegen-units = 1                  # Better optimization
panic = 'abort'                    # Smaller binary

# TODO: Add benchmarks later
# [[bench]]
# name = "storage_bench"
# harness = false
